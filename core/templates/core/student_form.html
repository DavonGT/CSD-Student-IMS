<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Student</title>
    {% load static %}
    <title>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Student</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'core/css/modal.css' %}">
</head>
<body class="container mt-5">
    <div class="modal">
        <div class="modal-content">
            <h2 class="mb-4">{% if form.instance.pk %}Edit{% else %}Add{% endif %} Student</h2>
            <form method="post" class="needs-validation">
                {% csrf_token %}
                
                <!-- Other Student Fields -->
                <h3>Personal Info</h3>

                {{ form.first_name.label }} {{ form.first_name }}
                 
                {{ form.middle_name.label }} {{ form.middle_name }}
                 
                {{ form.last_name.label }} {{ form.last_name }}
                 
                {{ form.student_id.label }} {{ form.student_id }}
                 
                {{ form.year_level.label }} {{ form.year_level }}

                {{ form.status.label }} {{ form.status }}

                {{ form.email.label }} {{ form.email }}

                {{ form.date_of_birth.label }} {{ form.date_of_birth }}
                
                {{ form.gender.label }} {{ form.gender }}

                {{ form.phone_number.label }} {{ form.phone_number }}



                <!-- Current Address -->
                <h3>Current Address</h3>
                <div class="mb-3">
                    <label for="id_current_province_code" class="form-label">Province</label>
                    <select id="id_current_province_code" name="current_province_code" class="form-select">
                        <option value="">Select Province</option>
                        {% for province in provinces %}
                            <option value="{{ province.code }}">{{ province.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="id_current_city_code" class="form-label">City/Municipality</label>
                    <select id="id_current_city_code" name="current_city_code" class="form-select">
                        <option value="">Select City/Municipality</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="id_current_barangay_code" class="form-label">Barangay</label>
                    <select id="id_current_barangay_code" name="current_barangay_code" class="form-select">
                        <option value="">Select Barangay</option>
                    </select>
                </div>

                <!-- Permanent Address -->
                 <h3>Permanent Address</h3>
                <div class="mb-3">
                    <label for="id_permanent_province_code" class="form-label">Province</label>
                    <select id="id_permanent_province_code" name="permanent_province_code" class="form-select">
                        <option value="">Select Province</option>
                        {% for province in provinces %}
                            <option value="{{ province.code }}">{{ province.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="id_permanent_city_code" class="form-label">City/Municipality</label>
                    <select id="id_permanent_city_code" name="permanent_city_code" class="form-select">
                        <option value="">Select City/Municipality</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="id_permanent_barangay_code" class="form-label">Barangay</label>
                    <select id="id_permanent_barangay_code" name="permanent_barangay_code" class="form-select">
                        <option value="">Select Barangay</option>
                    </select>
                </div>

                <h3>Emergency Contact Info</h3>
                {{ form.emergency_contact_name.label }} {{ form.emergency_contact_name }}
                {{ form.emergency_contact_phone.label }} {{ form.emergency_contact_phone }}
                {{ form.emergency_contact_relation.label }} {{ form.emergency_contact_relation }}


                
                <button type="submit" class="btn btn-primary">Save</button>
                <a href="{% url 'student_list' %}" class="btn btn-secondary" style="width: 310px; height: 46px; padding: 10px 0;">Cancel</a>
            </form>
        </div>
    </div>

    <!-- JavaScript for Dynamic Address Population -->
    <script>
        document.getElementById("id_current_province_code").addEventListener("change", function () {
            const provinceCode = this.value;
            if (provinceCode) {
                fetch(`https://psgc.gitlab.io/api/provinces/${provinceCode}/cities-municipalities/`)
                    .then(response => response.json())
                    .then(data => {
                        const citySelect = document.getElementById("id_current_city_code");
                        citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
                        document.getElementById("id_current_barangay_code").innerHTML = '<option value="">Select Barangay</option>';
                        data.forEach(city => {
                            const option = document.createElement("option");
                            option.value = city.code;
                            option.textContent = city.name;
                            citySelect.appendChild(option);
                        });
                    });
            }
        });
        
        document.getElementById("id_current_city_code").addEventListener("change", function () {
            const cityCode = this.value;
            if (cityCode) {
                fetch(`https://psgc.gitlab.io/api/cities-municipalities/${cityCode}/barangays/`)
                    .then(response => response.json())
                    .then(data => {
                        const barangaySelect = document.getElementById("id_current_barangay_code");
                        barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
                        data.forEach(barangay => {
                            const option = document.createElement("option");
                            option.value = barangay.code;
                            option.textContent = barangay.name;
                            barangaySelect.appendChild(option);
                        });
                    });
            }
        });
        

        document.getElementById("id_permanent_province_code").addEventListener("change", function () {
            const provinceCode = this.value;
            if (provinceCode) {
                fetch(`https://psgc.gitlab.io/api/provinces/${provinceCode}/cities-municipalities/`)
                    .then(response => response.json())
                    .then(data => {
                        const citySelect = document.getElementById("id_permanent_city_code");
                        citySelect.innerHTML = '<option value="">Select City/Municipality</option>';
                        document.getElementById("id_permanent_barangay_code").innerHTML = '<option value="">Select Barangay</option>';
                        data.forEach(city => {
                            const option = document.createElement("option");
                            option.value = city.code;
                            option.textContent = city.name;
                            citySelect.appendChild(option);
                        });
                    });
            }
        });
        
        document.getElementById("id_permanent_city_code").addEventListener("change", function () {
            const cityCode = this.value;
            if (cityCode) {
                fetch(`https://psgc.gitlab.io/api/cities-municipalities/${cityCode}/barangays/`)
                    .then(response => response.json())
                    .then(data => {
                        const barangaySelect = document.getElementById("id_permanent_barangay_code");
                        barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
                        data.forEach(barangay => {
                            const option = document.createElement("option");
                            option.value = barangay.code;
                            option.textContent = barangay.name;
                            barangaySelect.appendChild(option);
                        });
                    });
            }
        });
        
    </script>
</body>
</html>

